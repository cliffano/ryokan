---
- hosts: delllatitude00

  vars:
    docker_images:
      - { id: aembuildenv, image: 'shinesolutions/aem-platform-buildenv' }
    main_workspaces:
      - control
    project_workspaces:
      - bussaoc
      - bussdig
      - busspla
      - bussint

  tasks:

  - name: Set git config
    file: src={{ home }}/dev/workspace-control/config/tools/git/.gitconfig-{{ inventory_hostname }} dest='{{ home }}/.gitconfig' state=link

  - name: Set git config for GitHub repos
    file: src={{ home }}/dev/workspace-control/config/tools/git/.gitconfig-{{ inventory_hostname }}-github dest='{{ home }}/.gitconfig-github' state=link

  - name: Set git config for BitBucket repos
    file: src={{ home }}/dev/workspace-control/config/tools/git/.gitconfig-{{ inventory_hostname }}-bitbucket dest='{{ home }}/.gitconfig-bitbucket' state=link

  - name: Ensure SSH directory exists
    file: path={{ home }}/.ssh/ state=directory

  - name: Ensure SSH config directory exists
    file: path={{ home }}/.ssh/config.d/ state=directory

  - name: Ensure utility packages are installed
    become: yes
    ansible.builtin.package:
      name:
        - curl
        - docker
        - telnet
        - wget
      state: latest

  - name: Ensure global node.js packages are installed
    npm: name="{{item}}" global=yes state=present
    with_items:
      - repoman
      - nestor

  - name: Ensure main workspace directories exist
    file: path={{ home }}/dev/workspace-{{ item }} state=directory mode=0755
    with_items: "{{ main_workspaces }}"

  - name: Set Repoman configuration for main workspace repositories
    ansible.builtin.copy: src={{ home }}/dev/workspace-control/config/workspaces/{{ item }}/.repoman.json dest={{ home }}/dev/workspace-{{ item }}/.repoman.json mode='0644'
    with_items: "{{ main_workspaces }}"

  - name: Ensure project workspace directories exist
    file: path={{ home }}/dev/workspace-{{ item }} state=directory mode=0755
    with_items: "{{ project_workspaces }}"

  - name: Set Repoman configuration for project workspace repositories
    ansible.builtin.copy: src={{ home }}/dev/workspace-control/config/workspaces/{{ item }}/.repoman.json dest={{ home }}/dev/workspace-{{ item }}/.repoman.json mode='0644'
    with_items: "{{ project_workspaces }}"
